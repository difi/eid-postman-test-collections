{
  "info": {
    "_postman_id": "b162ef8c-9501-404f-8b87-2eb1f8e8643c",
    "name": "Oidcprovider API",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "name": "oidc-controller negative tests",
      "item": [
        {
          "name": "oidc-client-controller",
          "item": [
            {
              "name": "/clients",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "81193e3f-c47b-4c82-b2e3-b07850b74304",
                    "exec": [
                      "pm.test(\"Get Clients \", function () {",
                      "        ",
                      "pm.response.to.have.status(200);",
                      "var jsonData = pm.response.json();",
                      "console.log(\"clients \",jsonData);",
                      "",
                      "});",
                      ""
                    ],
                    "type": "text/javascript"
                  }
                },
                {
                  "listen": "prerequest",
                  "script": {
                    "id": "71df21c3-6cee-487b-93dd-b7f740e5cc5e",
                    "exec": [
                      ""
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "_postman_id": "b0760257-0cd7-44f1-a13d-a3ef21d0c6c6",
              "protocolProfileBehavior": {
                "disableBodyPruning": true
              },
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": {
                    "token": "{{invalid_access_token_sp}}"
                  }
                },
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{serviceprovider_api}}/clients?inactive=true",
                  "host": [
                    "{{serviceprovider_api}}"
                  ],
                  "path": [
                    "clients"
                  ],
                  "query": [
                    {
                      "key": "inactive",
                      "value": "true"
                    }
                  ]
                },
                "description": "Optional attributt \"inactive\" [true|false] som filtreringsparameter"
              },
              "response": []
            },
            {
              "name": "/clients",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "d3d45bdc-d96a-4461-965a-a4858d750ff3",
                    "exec": [
                      "pm.test(\"Access is denied\", function () {",
                      "    pm.response.to.have.status(403);",
                      "});",
                      "",
                      "pm.test(\"Error description\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    console.log(\"error\",jsonData.error);",
                      "    console.log(\"error_description\",jsonData.error_description);",
                      "",
                      "}",
                      "",
                      ");"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "_postman_id": "31e8a3ca-e3f0-4278-8261-1d2fa180c199",
              "protocolProfileBehavior": {
                "disableBodyPruning": true
              },
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": {
                    "token": "{{invalid_access_token_sp}}"
                  }
                },
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "name": "Content-Type",
                    "type": "text",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"client_name\": \"knut-oidc-test\",\n    \"description\": \"Knut sin testklient oidc\",\n    \"authorization_lifetime\": 3600,\n    \"access_token_lifetime\": 3600,\n    \"refresh_token_lifetime\": 3600,\n    \"client_type\": \"PUBLIC\",\n    \"token_reference\": \"OPAQUE\",\n    \"refresh_token_usage\": \"ONETIME\",\n    \"frontchannel_logout_session_required\": false,\n    \"force_pkce\": false,\n    \"client_id\": \"123456789\",\n    \"client_orgno\": null,\n    \"client_uri\": \"https://wwww.knut.no\",\n    \"supplier_orgno\": null,\n    \"active\": false,\n    \"default_scopes\": [],\n    \"logo_uri\": \"bilde.gif\",\n    \"grant_types\": [\"urn:ietf:params:oauth:grant-type:jwt-bearer\"],\n    \"last_updated\": \"2019-03-21T17:03:59.583+01:00\",\n    \"created\": \"2019-03-08T15:50:40.540+01:00\"\n}"
                },
                "url": "{{serviceprovider_api}}/clients"
              },
              "response": []
            },
            {
              "name": "/clients/{id}",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "cd27aa17-bac8-4ef4-85c7-a38399314692",
                    "exec": [
                      "pm.test(\"Status code is 200\", function () {",
                      "    pm.response.to.have.status(200);",
                      "});",
                      "",
                      "pm.test(\"/get clients \", function () {",
                      "    var jsonData = pm.response.json();",
                      "   console.log(\"get clients \",jsonData.value);",
                      "});"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "_postman_id": "768f76bc-7dd4-4bfd-b8eb-ab61c1bfb1c2",
              "protocolProfileBehavior": {
                "disableBodyPruning": true
              },
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": {
                    "token": "{{invalid_access_token_sp}}"
                  }
                },
                "method": "GET",
                "header": [],
                "url": {
                  "raw": "{{serviceprovider_api}}/clients/{{sp_client_id}}?inactive=true",
                  "host": [
                    "{{serviceprovider_api}}"
                  ],
                  "path": [
                    "clients",
                    "{{sp_client_id}}"
                  ],
                  "query": [
                    {
                      "key": "inactive",
                      "value": "true"
                    }
                  ]
                }
              },
              "response": []
            },
            {
              "name": "/clients/{id}/secret",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "b9f3a50e-fc94-4689-9f9f-b8381510c971",
                    "exec": [
                      "pm.test(\"Status code is 403\", function () {",
                      "    pm.response.to.have.status(403);",
                      "});",
                      "",
                      "pm.test(\"Error description\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    console.log(\"error\",jsonData.error);",
                      "    console.log(\"error_description\",jsonData.error_description);",
                      "",
                      "}",
                      "",
                      ");"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "_postman_id": "5445d0dd-9af7-43d0-a5e4-c510b741af60",
              "protocolProfileBehavior": {
                "disableBodyPruning": true
              },
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": {
                    "token": "{{invalid_access_token_sp}}"
                  }
                },
                "method": "POST",
                "header": [],
                "body": {
                  "mode": "raw",
                  "raw": ""
                },
                "url": "{{serviceprovider_api}}/clients/test11/secret"
              },
              "response": []
            },
            {
              "name": "/clients",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "a8881322-43a7-4570-bdd3-88d8f73c9a97",
                    "exec": [
                      "pm.test(\"Status code is 403\", function () {",
                      "    pm.response.to.have.status(403);",
                      "});",
                      "",
                      "pm.test(\"Error description\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    console.log(\"error\",jsonData.error);",
                      "    console.log(\"error_description\",jsonData.error_description);",
                      "",
                      "}",
                      "",
                      ");"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "_postman_id": "8e8ab4fc-a2b5-4e8a-b211-9022fe170fad",
              "protocolProfileBehavior": {
                "disableBodyPruning": true
              },
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": {
                    "token": "{{invalid_access_token_sp}}"
                  }
                },
                "method": "PUT",
                "header": [
                  {
                    "key": "Content-Type",
                    "type": "text",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\n    \"client_name\": \"oidc_testautomasjon_test3\",\n    \"description\": \"cucumber-creating_oidc_client_for_postman\",\n\t\"grant_types\": [\"urn:ietf:params:oauth:grant-type:jwt-bearer\"],    \n    \"scopes\": [\n        \"openid\",\n        \"profile\"\n    ]\n}"
                },
                "url": "{{serviceprovider_api}}/clients/test12"
              },
              "response": []
            },
            {
              "name": "/clients/{id}",
              "event": [
                {
                  "listen": "test",
                  "script": {
                    "id": "587a4b78-014f-4a13-85c8-147881ab6d24",
                    "exec": [
                      "pm.test(\"Status code is 403\", function () {",
                      "    pm.response.to.have.status(403);",
                      "});",
                      "pm.test(\"Error description\", function () {",
                      "    var jsonData = pm.response.json();",
                      "    console.log(\"error\",jsonData.error);",
                      "    console.log(\"error_description\",jsonData.error_description);",
                      "",
                      "}",
                      "",
                      ");"
                    ],
                    "type": "text/javascript"
                  }
                }
              ],
              "_postman_id": "4bc34907-8f0d-4b1f-b21e-ea83ab107b5b",
              "protocolProfileBehavior": {
                "disableBodyPruning": true
              },
              "request": {
                "auth": {
                  "type": "bearer",
                  "bearer": {
                    "token": "{{invalid_access_token_sp}}"
                  }
                },
                "method": "DELETE",
                "header": [
                  {
                    "key": "Content-Type",
                    "name": "Content-Type",
                    "type": "text",
                    "value": "application/json"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": ""
                },
                "url": "{{serviceprovider_api}}/clients/tetsts"
              },
              "response": []
            }
          ],
          "_postman_id": "36cbf1d1-79eb-4184-ab6c-6ad808b837bc",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "id": "8e6df318-4559-4430-929b-f60841bc276e",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            },
            {
              "listen": "test",
              "script": {
                "id": "a772d638-b89f-4d6a-96ca-c77af18fe48c",
                "type": "text/javascript",
                "exec": [
                  ""
                ]
              }
            }
          ],
          "_postman_isSubFolder": true
        }
      ],
      "_postman_id": "12f329b2-2d5c-47b6-b654-b1334912f75d",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "8e6df318-4559-4430-929b-f60841bc276e",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "a772d638-b89f-4d6a-96ca-c77af18fe48c",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "name": "Hente gyldig accesstoken med riktig scope",
      "item": [
        {
          "name": "postreq",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "713e1a24-6a6c-4137-b6ec-ec8c924b3c95",
                "exec": [
                  "var jsonData=pm.response.json();",
                  "pm.globals.set(\"session\",jsonData.sessionId);",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "a808d631-24aa-4dcd-b0f2-1debda403a27",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n    \"desiredCapabilities\": {\r\n        \"caps\": {\r\n            \"nativeEvents\": false,\r\n            \"browserName\": \"chrome\",\r\n            \"version\": \"\",\r\n            \"platform\": \"ANY\"\r\n        }\r\n    }\r\n}"
            },
            "url": "http://localhost:9515/session"
          },
          "response": [
            {
              "id": "1e2b50ba-259a-4823-9c73-2e12753468a4",
              "name": "postreq",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "name": "Content-Type",
                    "value": "application/json",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\r\n    \"desiredCapabilities\": {\r\n        \"caps\": {\r\n            \"nativeEvents\": false,\r\n            \"browserName\": \"chrome\",\r\n            \"version\": \"\",\r\n            \"platform\": \"ANY\"\r\n\r\n        }\r\n    }\r\n}"
                },
                "url": "http://localhost:9515/session"
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "Text",
              "header": [],
              "cookie": [],
              "responseTime": null,
              "body": ""
            }
          ]
        },
        {
          "name": "navigatetojwturl",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "227958f2-7dc9-4d24-a52e-9381fe8f9734",
                "exec": [
                  "tests[\"sessionId\"]=responseBody.has(\"sessionId\");",
                  "tests[\"client_id is status\"]=responseBody.has(\"status\");",
                  "tests[\"value\"]=responseBody.has(\"value\");",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "f34cf1b1-bca7-48bc-9140-ca070ddad037",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"url\":\"{{jwt_bearer_url_scope_for_alle_api}}\"}\n"
            },
            "url": "http://localhost:9515/session/{{session}}/url"
          },
          "response": []
        },
        {
          "name": "assertionrequest",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "227958f2-7dc9-4d24-a52e-9381fe8f9734",
                "exec": [
                  "var jsonData = pm.response.json();\r",
                  "var jwtgrantString=jsonData.value;\r",
                  "var jwtgranttrim = jwtgrantString.substring(\r",
                  "    jwtgrantString.lastIndexOf(\"<body>\") +1, \r",
                  "    jwtgrantString.lastIndexOf(\"</body>\")\r",
                  ");\r",
                  "var assertiontmp=jwtgranttrim.substring(5);\r",
                  "console.log(assertiontmp);\r",
                  "pm.environment.set(\"assertion\", assertiontmp);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "b0e76300-800b-4115-85ae-835946690e68",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "http://localhost:9515/session/{{session}}/source"
          },
          "response": []
        },
        {
          "name": "tokenendepunkt",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "4bf7af09-414c-4b1b-8c0d-8fa6422b7038",
                "exec": [
                  "var jsonData=pm.response.json();",
                  "pm.environment.set(\"oidctoken\",jsonData.access_token);",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "2eb5219c-67e0-44ab-a804-96a85a6fd826",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/x-www-form-urlencoded",
                "type": "text"
              },
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
                  "type": "text"
                },
                {
                  "key": "assertion",
                  "value": "{{assertion}}",
                  "type": "text"
                }
              ]
            },
            "url": "https://eid-systest-web01.dmz.local/idporten-oidc-provider/token"
          },
          "response": []
        }
      ],
      "_postman_id": "0b4f43b9-da3c-4f28-bfa8-15ce0ccd1221"
    }
  ]
}