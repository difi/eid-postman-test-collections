{
  "info": {
    "_postman_id": "b162ef8c-9501-404f-8b87-2eb1f8e8643c",
    "name": "Oidcprovider API",
    "schema": "https://schema.getpostman.com/json/collection/v2.0.0/collection.json"
  },
  "item": [
    {
      "name": "Hente gyldig accesstoken med riktig scope med Jwtgrant",
      "item": [
        {
          "name": "postreq",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "713e1a24-6a6c-4137-b6ec-ec8c924b3c95",
                "exec": [
                  "var jsonData=pm.response.json();",
                  "pm.globals.set(\"session\",jsonData.sessionId);",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "a808d631-24aa-4dcd-b0f2-1debda403a27",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n    \"desiredCapabilities\": {\r\n        \"caps\": {\r\n            \"nativeEvents\": false,\r\n            \"browserName\": \"chrome\",\r\n            \"version\": \"\",\r\n            \"platform\": \"ANY\"\r\n        }\r\n    }\r\n}"
            },
            "url": "http://localhost:9515/session"
          },
          "response": [
            {
              "id": "1e2b50ba-259a-4823-9c73-2e12753468a4",
              "name": "postreq",
              "originalRequest": {
                "method": "POST",
                "header": [
                  {
                    "key": "Content-Type",
                    "name": "Content-Type",
                    "value": "application/json",
                    "type": "text"
                  }
                ],
                "body": {
                  "mode": "raw",
                  "raw": "{\r\n    \"desiredCapabilities\": {\r\n        \"caps\": {\r\n            \"nativeEvents\": false,\r\n            \"browserName\": \"chrome\",\r\n            \"version\": \"\",\r\n            \"platform\": \"ANY\"\r\n\r\n        }\r\n    }\r\n}"
                },
                "url": "http://localhost:9515/session"
              },
              "status": "OK",
              "code": 200,
              "_postman_previewlanguage": "Text",
              "header": [],
              "cookie": [],
              "responseTime": null,
              "body": ""
            }
          ]
        },
        {
          "name": "navigatetojwturl",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "227958f2-7dc9-4d24-a52e-9381fe8f9734",
                "exec": [
                  "tests[\"sessionId\"]=responseBody.has(\"sessionId\");",
                  "tests[\"client_id is status\"]=responseBody.has(\"status\");",
                  "tests[\"value\"]=responseBody.has(\"value\");",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "f34cf1b1-bca7-48bc-9140-ca070ddad037",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"url\":\"http://34.239.102.186/jwtgrant?issuer={{clientId}}&audience={{audience_url}}/&scope=profile%20idporten:scopes.write%20idporten:scopes.read%20idporten:authorizations.revoke%20tokeninfo\"}\n",
              "options": {
                "raw": {}
              }
            },
            "url": "http://localhost:9515/session/{{session}}/url"
          },
          "response": []
        },
        {
          "name": "assertionrequest",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "227958f2-7dc9-4d24-a52e-9381fe8f9734",
                "exec": [
                  "var jsonData = pm.response.json();\r",
                  "var jwtgrantString=jsonData.value;\r",
                  "var jwtgranttrim = jwtgrantString.substring(\r",
                  "    jwtgrantString.lastIndexOf(\"<body>\") +1, \r",
                  "    jwtgrantString.lastIndexOf(\"</body>\")\r",
                  ");\r",
                  "var assertiontmp=jwtgranttrim.substring(5);\r",
                  "console.log(assertiontmp);\r",
                  "pm.environment.set(\"assertion\", assertiontmp);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "b0e76300-800b-4115-85ae-835946690e68",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "http://localhost:9515/session/{{session}}/source"
          },
          "response": []
        },
        {
          "name": "/token",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "1f3295d0-e688-46da-be03-2a38c4a701c9",
                "exec": [
                  "",
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    var jsonData=pm.response.json();",
                  "    pm.environment.set(\"oidctoken\",jsonData.access_token);",
                  "",
                  "});",
                  "pm.test(\"test should check scope parameter\", function () {",
                  "    var jsonData = pm.response.json();",
                  "    pm.expect(jsonData.scope).to.eql(\"idporten:scopes.write profile idporten:scopes.read idporten:authorizations.revoke tokeninfo\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "17dd94fe-6ea3-4365-8dda-116226028c90",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/x-www-form-urlencoded",
                "type": "text"
              },
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "grant_type",
                  "value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
                  "type": "text"
                },
                {
                  "key": "assertion",
                  "value": "{{assertion}}",
                  "type": "text"
                }
              ]
            },
            "url": "{{oidc_provider}}/token"
          },
          "response": []
        },
        {
          "name": "/tokeninfo",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "3ba45f82-4ce7-45f0-a759-b952b2ed6768",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    ",
                  "    var jsonData=pm.response.json();",
                  "    pm.environment.set(\"auth_id\",jsonData.active);",
                  "    pm.expect(jsonData.active).to.eql(true);",
                  "    pm.expect(jsonData.client_id).to.eql(pm.environment.get(\"clientId\"));",
                  "    pm.expect(jsonData.token_type).to.eql(\"Bearer\");    ",
                  "    pm.expect(jsonData.client_orgno).to.eql(\"991825827\");",
                  "    ",
                  "});",
                  "",
                  "  ",
                  "pm.test(\"expires_in should be above 0\", function () {",
                  "    var jsonData=pm.response.json();",
                  "    var exp= jsonData.exp;",
                  "    var iat= jsonData.iat;",
                  "    var expires_in=exp-iat;",
                  "    pm.expect(expires_in).to.be.above(0);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "be23f5af-5d48-46a5-8a29-6e9166742d8f",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/x-www-form-urlencoded",
                "type": "text"
              },
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "value": "{{oidctoken}}",
                  "type": "text"
                }
              ]
            },
            "url": "{{oidc_provider}}/tokeninfo"
          },
          "response": []
        }
      ],
      "_postman_id": "0b4f43b9-da3c-4f28-bfa8-15ce0ccd1221"
    },
    {
      "name": "Hente gyldig accesstoken med riktig scope med code grant",
      "item": [
        {
          "name": "seleniumsession",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "d8b2c24d-e0ff-4735-a53e-d1fd6c1e91b7",
                "exec": [
                  "var jsonData=pm.response.json();",
                  "pm.globals.set(\"session\",jsonData.sessionId);"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "a37a8c83-7cef-49f7-b96c-d1ecdc0ffb0f",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\r\n    \"desiredCapabilities\": {\r\n        \"caps\": {\r\n            \"nativeEvents\": false,\r\n            \"browserName\": \"chrome\",\r\n            \"version\": \"\",\r\n            \"platform\": \"ANY\"\r\n        }\r\n    }\r\n}"
            },
            "url": "http://localhost:9515/session",
            "description": "\n"
          },
          "response": []
        },
        {
          "name": "redirecturl",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "id": "f32d6f05-2e34-4788-9d50-03fd801eb09e",
                "exec": [
                  "",
                  "pm.environment.get(\"oidc_url_serviceprovider\");"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "2950085e-ab96-4f04-806f-d789b8b99c56",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"url\":\"{{idporten_oidc_client_url}}\"}\n"
            },
            "url": "http://localhost:9515/session/{{session}}/url"
          },
          "response": []
        },
        {
          "name": "findclientelementid",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "1d20f14d-4667-407b-b870-4b0051ebd97b",
                "exec": [
                  "pm.test(\"find element id for client_id \", function () {",
                  "    var jsonData = pm.response.json();",
                  " pm.globals.set(\"clientid\", jsonData.value.ELEMENT);",
                  " ",
                  "console.log(pm.globals.get(\"clientid\"));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "e05d10a0-567d-42f5-9c67-403d1d757e3b",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"name\",\"value\":\"client_id\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "selectdropdown",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a9c5f504-80da-4b67-bd66-86c7cb3558c4",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "d468f6be-d92e-421b-acc0-ee80e1b68edd",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "\r\n{\r\n\t\"value\":{{client_drop_down}}\r\n}"
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{clientid}}/value"
          },
          "response": []
        },
        {
          "name": "findscopeid",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "1d20f14d-4667-407b-b870-4b0051ebd97b",
                "exec": [
                  "pm.test(\"Scope element id\", function () {",
                  "    var jsonData = pm.response.json();",
                  " pm.globals.set(\"scope\", jsonData.value.ELEMENT);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "6743cc2f-cb6c-47c2-bb76-06d4bf7856a7",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"name\",\"value\":\"scope\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "setscope",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "id": "e65befc8-4e49-43f6-a2bc-3ebfdc77a6dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "d5186706-a41f-4f30-b769-d19ecab520b0",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"value\":[\"    krr:user.log.all.read idporten:user.log.read global/kontaktinformasjon.read idporten:dcr.write idporten:user.log.all.read user/sikkerdigitalpost.read dsf-adresse global/sertifikat.read global/varslingsstatus.read idporten:dcr.modify idporten:authorizations.revoke dsf-navn user/spraak.read idporten:tokenexchange idporten:scopes.read user/sertifikat.read user/digitalpost.read idporten:scopes.write user/spraak.write samarbeid:sp-web\" ]}",
              "options": {
                "raw": {}
              }
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{scope}}/value"
          },
          "response": []
        },
        {
          "name": "findloginelementid",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "1d20f14d-4667-407b-b870-4b0051ebd97b",
                "exec": [
                  "pm.test(\"Your test name\", function () {",
                  "    var jsonData = pm.response.json();",
                  " pm.globals.set(\"loginid\", jsonData.value.ELEMENT);",
                  "",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "694feb4a-4f30-4d80-8796-5a2e80f54e2d",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"id\",\"value\":\"login\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "clicklogin",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "a9c5f504-80da-4b67-bd66-86c7cb3558c4",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "prerequest",
              "script": {
                "id": "5f95f475-e14e-4a9f-9448-803200c232cd",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "29017c89-fd29-4216-8080-3323a86bbca0",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "type": "text",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{loginid}}/click"
          },
          "response": []
        },
        {
          "name": "elementonthispage",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "4d4bd4ba-154b-4b05-923d-64e1d36be0a1",
                "exec": [
                  "pm.test(\"element if for MinID \", function () {",
                  "    var jsonData = pm.response.json();",
                  " pm.globals.set(\"minid_elementid\", jsonData.value.ELEMENT);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "b62a6b1b-bff6-4e1a-90ab-2a786b10df1e",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/x-www-form-urlencoded",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"id\",\"value\":\"MinIDChain\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "clickonminid",
          "_postman_id": "dce5d4f3-a34f-4787-979c-e71d704e85f5",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{minid_elementid}}/click"
          },
          "response": []
        },
        {
          "name": "getelementidssn",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "189f83ec-8efd-438c-b133-0fbc201abad0",
                "exec": [
                  "var jsonData = pm.response.json();",
                  " pm.globals.set(\"ssn_elementid\", jsonData.value.ELEMENT);",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "72e0db0d-a476-4860-938f-bc1a7d5667e0",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"id\",\"value\":\"input_USERNAME_IDPORTEN\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "getelementidpassword",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "8929c791-35e2-41f7-8b0b-8678e9309e58",
                "exec": [
                  "var jsonData = pm.response.json();",
                  " pm.globals.set(\"password_elementid\", jsonData.value.ELEMENT);",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "7d651e37-22ac-4335-9c18-55110c3b08ea",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"id\",\"value\":\"input_PASSWORD_IDPORTEN\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "setssn",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "id": "e65befc8-4e49-43f6-a2bc-3ebfdc77a6dc",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "8ef2fb97-25d9-4f1d-9dd0-ca2d23c23125",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"value\":[\"{{ssn}}\"]}"
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{ssn_elementid}}/value"
          },
          "response": []
        },
        {
          "name": "setpassword",
          "_postman_id": "e90106ff-5e35-440f-97d8-042f5437ccb9",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"value\":[\"password01\"]}"
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{password_elementid}}/value"
          },
          "response": []
        },
        {
          "name": "submit",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "d4ee6a6d-0d1e-4948-aaa6-a2829f185475",
                "exec": [
                  "pm.test(\"next_elementid\", function () {",
                  "    var jsonData = pm.response.json();",
                  " pm.globals.set(\"next_elementid\", jsonData.value.ELEMENT);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "42498a82-7d2d-4ba1-b620-0e297827bc63",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"id\",\"value\":\"nextbtn\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "clicksubmit",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "e75ea17b-88ea-4c32-b35f-8758d03c48c1",
                "exec": [
                  "setTimeout(checkStatusCode, 500);\r",
                  "\r",
                  "    function checkStatusCode() {\r",
                  "\r",
                  "        pm.sendRequest('https://postman-echo.com/get', function (err, res) {\r",
                  "\r",
                  "            tests['status code should be 200']= res.code ===200;\r",
                  "\r",
                  "        });\r",
                  "    }"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "dead990b-2c12-4aa8-9a24-9aa1f21ae402",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{next_elementid}}/click"
          },
          "response": []
        },
        {
          "name": "pinnumberid",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "49f2b57c-29a8-41bf-9041-7400083bf039",
                "exec": [
                  "pm.test(\"pin_elementid\", function () {",
                  "    var jsonData = pm.response.json();",
                  " pm.globals.set(\"pin_elementid\", jsonData.value.ELEMENT);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "446cc231-c2da-46ac-b6ec-771c1a051c34",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"id\",\"value\":\"input_PINCODE1_IDPORTEN\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "setppin",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "95b50532-96b7-405c-afd1-52b576a70e9f",
                "exec": [
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "001f0e32-f45f-4c08-ba35-0cc09fd35efd",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"value\":[\"12345\"]}"
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{pin_elementid}}/value"
          },
          "response": []
        },
        {
          "name": "getsubmitid",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "02b4c223-cb45-4310-b064-d60510887571",
                "exec": [
                  "pm.test(\"submit_elementid\", function () {",
                  "    var jsonData = pm.response.json();",
                  " pm.globals.set(\"submit_elementid\", jsonData.value.ELEMENT);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "e7c93c74-800b-42a2-b41c-e517712b8b23",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"id\",\"value\":\"nextbtn\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "finalsubmit ",
          "_postman_id": "2ed30758-5913-4c77-9cf3-e02200fbcc0f",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{submit_elementid}}/click"
          },
          "response": []
        },
        {
          "name": "getconsentid",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "02b4c223-cb45-4310-b064-d60510887571",
                "exec": [
                  "pm.test(\"consent_elementid\", function () {",
                  "    var jsonData = pm.response.json();",
                  " pm.globals.set(\"consent_elementid\", jsonData.value.ELEMENT);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "12bac0a5-7eaa-4c32-bbfd-ef7af18b3a9a",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"name\",\"value\":\"consentAccepted\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "acceptconsent",
          "_postman_id": "693245ac-b44d-40db-9aa3-699843969a44",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "file",
              "file": {
                "src": ""
              }
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{consent_elementid}}/click"
          },
          "response": []
        },
        {
          "name": "gettokenid",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "02b4c223-cb45-4310-b064-d60510887571",
                "exec": [
                  "pm.test(\"token_elementid\", function () {",
                  "    var jsonData = pm.response.json();",
                  " pm.globals.set(\"token_elementid\", jsonData.value.ELEMENT);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "49ca8fe6-f563-456b-9070-66fce4e1cbdb",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\"using\":\"id\",\"value\":\"get-tokens\"}"
            },
            "url": "http://localhost:9515/session/{{session}}/element"
          },
          "response": []
        },
        {
          "name": "henttoken",
          "_postman_id": "a353d535-40e4-4e34-b80a-a73705ffc463",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [],
            "body": {
              "mode": "file",
              "file": {}
            },
            "url": "http://localhost:9515/session/{{session}}/element/{{token_elementid}}/click"
          },
          "response": []
        },
        {
          "name": "getTokensElements",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "02b4c223-cb45-4310-b064-d60510887571",
                "exec": [
                  "pm.test(\"tokens\", function () {",
                  " var jsonData = pm.response.json();",
                  " console.log('tokens test jsonData',jsonData);",
                  " var tokens=jsonData.value;",
                  "  console.log('tokens test tokens',tokens);",
                  " var temptoken=tokens.split('access_token:').pop();",
                  "   console.log('tokens test temptoken',temptoken);",
                  " var refreshtokenpos=temptoken.lastIndexOf(\"refresh_token:\");",
                  "    console.log('tokens test refreshtokenpos',refreshtokenpos);",
                  " var token = temptoken.substring(1,refreshtokenpos-1);    ",
                  " pm.environment.set(\"oidctoken\", token);",
                  "     console.log('oidctoken test token',token);",
                  "console.log('oidctoken',pm.environment.get(\"oidctoken\"));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "effb2838-de91-4e50-b13b-1f254f1f47bb",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": "http://localhost:9515/session/{{session}}/source"
          },
          "response": []
        },
        {
          "name": "/tokeninfo",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "9e64abfc-00a1-49d4-99b5-3a34a0641dd5",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "    ",
                  "        var jsonData=pm.response.json();",
                  "pm.environment.set(\"auth_id\",jsonData.active);",
                  "    pm.expect(jsonData.active).to.eql(true);",
                  "    pm.expect(jsonData.client_id).to.eql(\"oidc_test_api-postman\");",
                  "    pm.expect(jsonData.client_orgno).to.eql(\"991825827\");",
                  "    pm.expect(jsonData.delegation_source).to.eql(\"https://eid-systest-web01.dmz.local/idporten-oidc-provider/\");",
                  "",
                  "",
                  "});",
                  "",
                  "pm.test(\"expires_in should be above 0\", function () {",
                  "    var jsonData=pm.response.json();",
                  "        var exp= jsonData.exp;",
                  "    var iat= jsonData.iat;",
                  "    var expires_in=exp-iat;",
                  "        console.log('oidctoken test iat',iat);",
                  "     console.log('oidctoken test expires_in',expires_in);",
                  "    pm.expect(expires_in).to.be.above(0);",
                  "});",
                  ""
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "52ce75ec-30e0-47f6-ac30-144f7330c09d",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/x-www-form-urlencoded",
                "type": "text"
              },
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": [
                {
                  "key": "token",
                  "value": "{{oidctoken}}",
                  "type": "text"
                }
              ]
            },
            "url": "{{oidc_provider}}/tokeninfo"
          },
          "response": []
        },
        {
          "name": "/userinfo",
          "event": [
            {
              "listen": "test",
              "script": {
                "id": "5b377bbe-83c8-4893-a836-096ea3e592ce",
                "exec": [
                  "pm.test(\"Status code is 200\", function () {",
                  "    pm.response.to.have.status(200);",
                  "   ",
                  "    ",
                  "        var jsonData=pm.response.json();",
                  "   ",
                  "   pm.environment.set(\"auth_id\",jsonData.active);",
                  "    pm.expect(jsonData.pid).to.eql(\"23079403164\");",
                  "    pm.expect(jsonData.locale).to.eql( \"nb\");",
                  "    ",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "_postman_id": "7385fdde-5dab-4aef-ad0c-95ffe112728e",
          "protocolProfileBehavior": {
            "disableBodyPruning": true
          },
          "request": {
            "auth": {
              "type": "bearer",
              "bearer": {
                "token": "{{oidctoken}}"
              }
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "name": "Content-Type",
                "value": "application/x-www-form-urlencoded",
                "type": "text"
              }
            ],
            "body": {
              "mode": "urlencoded",
              "urlencoded": []
            },
            "url": "{{oidc_provider}}/userinfo"
          },
          "response": []
        }
      ],
      "_postman_id": "c6fb8742-c62d-4f28-94bf-783147018689",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "id": "f4a9f38e-d0e4-4879-ab65-f889cf12094e",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "id": "7b7f1c97-7c59-4651-9b42-6ab2f5d9c79c",
            "type": "text/javascript",
            "exec": [
              ""
            ]
          }
        }
      ]
    },
    {
      "name": "/token invalid grant test (grant has used)",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "4bf7af09-414c-4b1b-8c0d-8fa6422b7038",
            "exec": [
              "",
              "pm.test(\"invalid_grant should return 400\", function () {",
              "    pm.response.to.have.status(400);",
              "    var jsonData=pm.response.json();",
              "    console.log(\"values\"+jsonData.error);",
              "    var error=jsonData.error;",
              "    pm.expect(jsonData.error).to.include(\"invalid_grant\");",
              "    pm.expect(jsonData.error_description).to.be.include(\"Invalid assertion. Client authentication failed. Expired JWT. (correlation id: 6e6545e5-d4a3-43fc-a52c-e5eafc926f8d) \");",
              "    ",
              "  ",
              "console.log(\"values\"+jsonData.error_description);",
              "});"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "32df9a2b-f45d-41a8-921e-ada196775aca",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "name": "Content-Type",
            "value": "application/x-www-form-urlencoded",
            "type": "text"
          },
          {
            "key": "Accept",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "urlencoded",
          "urlencoded": [
            {
              "key": "grant_type",
              "value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
              "type": "text"
            },
            {
              "key": "assertion",
              "value": "{{assertion}}",
              "type": "text"
            }
          ],
          "options": {
            "urlencoded": {}
          }
        },
        "url": "{{oidc_provider}}/token"
      },
      "response": []
    },
    {
      "name": "/token invalid grant test (expired grant )",
      "event": [
        {
          "listen": "test",
          "script": {
            "id": "4bf7af09-414c-4b1b-8c0d-8fa6422b7038",
            "exec": [
              "",
              "pm.test(\"invalid_grant should return 400\", function () {",
              "    pm.response.to.have.status(400);",
              "    var jsonData=pm.response.json();",
              "    console.log(\"values\"+jsonData.error);",
              "    var errorvalues=jsonData.error;",
              "    pm.expect(jsonData.error).to.include(\"invalid_grant\");",
              "    pm.expect(jsonData.error_description).to.include(\"Invalid assertion. Client authentication failed. Expired JWT.\");",
              " });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "_postman_id": "ae3ed213-bf5b-477c-9604-bb35535056f5",
      "protocolProfileBehavior": {
        "disableBodyPruning": true
      },
      "request": {
        "auth": {
          "type": "noauth"
        },
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "name": "Content-Type",
            "value": "application/x-www-form-urlencoded",
            "type": "text"
          },
          {
            "key": "Accept",
            "value": "application/json",
            "type": "text"
          }
        ],
        "body": {
          "mode": "urlencoded",
          "urlencoded": [
            {
              "key": "grant_type",
              "value": "urn:ietf:params:oauth:grant-type:jwt-bearer",
              "type": "text"
            },
            {
              "key": "assertion",
              "value": "eyJ4NWMiOlsiTUlJRkVUQ0NBXC9tZ0F3SUJBZ0lMQVVrblRnempPNTM2MHk4d0RRWUpLb1pJaHZjTkFRRUxCUUF3VVRFTE1Ba0dBMVVFQmhNQ1RrOHhIVEFiQmdOVkJBb01GRUoxZVhCaGMzTWdRVk10T1Rnek1UWXpNekkzTVNNd0lRWURWUVFEREJwQ2RYbHdZWE56SUVOc1lYTnpJRE1nVkdWemREUWdRMEVnTXpBZUZ3MHhOekEyTVRJd09EVTJNVEZhRncweU1EQTJNVEl5TVRVNU1EQmFNSGN4Q3pBSkJnTlZCQVlUQWs1UE1Td3dLZ1lEVlFRS0RDTkVTVkpGUzFSUFVrRlVSVlFnUms5U0lFWlBVbFpCVEZST1NVNUhJRTlISUVsTFZERVNNQkFHQTFVRUN3d0pUMGxFUXlCMFpYTjBNUkl3RUFZRFZRUUREQWxFU1VaSklGUkZVMVF4RWpBUUJnTlZCQVVUQ1RrNU1UZ3lOVGd5TnpDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTmduVWJpWFBtZ0E4T0J4blBhNFpsUkhLTlNpUjFPUUlqMXdZS0hyejRVMUhvV21HNStWVFpQWGJobVJ4MjBsR3FRV3JDMG1xVjJsXC9CclNUVHBNdW1vdFBNV01RTW1sVXdXcTBBWGRRRHgzSDVCR1lhNjZzVjU2eEl2QzRsektJMkVBR2pzeGRkZThYdzdheXBFNXVKXC9PVk15Y2JcL3c2bHFvRGlzOHRIeGlOMEs0WitJbFVMdnBmQ1k1NlA3QytjdVN6RlU3VVlramJ6OStYdVdabGdKRmZ3MmpBQVhnNnN6elorbHZsZUFJKzZvVXUzSGZwbnVKZUJST1wveGZEdmtjXC8wY0lQRlJIQUVlWjhuUXdic0VpK09WU0VGeVludFNXM1MwUGI5WW1KazBDSWl1Y0xuVlhKNVZCd3lsNldzYkRyY2tZZDZKT21iWEpHRVRcL050ZWhNQ0F3RUFBYU9DQWNJd2dnRytNQWtHQTFVZEV3UUNNQUF3SHdZRFZSMGpCQmd3Rm9BVVA2NzFlQXVTbzNBZ05WOWErdmNrb0ZJQjhFRXdIUVlEVlIwT0JCWUVGRWV5ZGR0S2tjZGl5RnR5dmIxblp3d0ViblRBTUE0R0ExVWREd0VCXC93UUVBd0lHUURBV0JnTlZIU0FFRHpBTk1Bc0dDV0NFUWdFYUFRQURBakNCdXdZRFZSMGZCSUd6TUlHd01EZWdOYUF6aGpGb2RIUndPaTh2WTNKc0xuUmxjM1EwTG1KMWVYQmhjM011Ym04dlkzSnNMMEpRUTJ4aGMzTXpWRFJEUVRNdVkzSnNNSFdnYzZCeGhtOXNaR0Z3T2k4dmJHUmhjQzUwWlhOME5DNWlkWGx3WVhOekxtNXZMMlJqUFVKMWVYQmhjM01zWkdNOVRrOHNRMDQ5UW5WNWNHRnpjeVV5TUVOc1lYTnpKVEl3TXlVeU1GUmxjM1EwSlRJd1EwRWxNakF6UDJObGNuUnBabWxqWVhSbFVtVjJiMk5oZEdsdmJreHBjM1F3Z1lvR0NDc0dBUVVGQndFQkJINHdmREE3QmdnckJnRUZCUWN3QVlZdmFIUjBjRG92TDI5amMzQXVkR1Z6ZERRdVluVjVjR0Z6Y3k1dWJ5OXZZM053TDBKUVEyeGhjM016VkRSRFFUTXdQUVlJS3dZQkJRVUhNQUtHTVdoMGRIQTZMeTlqY25RdWRHVnpkRFF1WW5WNWNHRnpjeTV1Ynk5amNuUXZRbEJEYkdGemN6TlVORU5CTXk1alpYSXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBRWNqS3FKdTNOb2FPRUNZVGVrNjZ3TmZqVzlpUnowVllMbHBiYzVBRkVjMmN1RWlld05SNlNoME1vNFRmeFpEVkFsaTJaaUVXYytybHZGYVMyaGJlYlIrYktVcnlQY1ZGU0NBdEM3MkQ0amE2ek1qdStOcHZFZXRUbjZrODFXZ2ZzZ2p4NlhOakpZY1wvNlFOanZUNE4yMmFkRXd5TXZoRThsamtTZzRkXC91ZFF5aTJEUWRIdDBTaHFcL1dLMDY4TitoS1JnK1JJSWRDdTZJbDlGU25keVlPMGF6V1pwY2p1akhWSDdwOHFLVlo1OEc4N0hEaUM2RmNwZVpCT216VFwvTzdYaVN5MTQxVTQzSmVGS0JYa1Z1cEMwT1lQb3NZR1BubXpFeHFXTHliZ2tiT1wvZFNsOG9EVHpJSWlmdnh5Q2QyaU1FQWMwNytPdUVlZkVUekF4anFCSE09Il0sImFsZyI6IlJTMjU2In0.eyJhdWQiOiJodHRwczpcL1wvZWlkLXN5c3Rlc3Qtd2ViMDEuZG16LmxvY2FsXC9pZHBvcnRlbi1vaWRjLXByb3ZpZGVyXC8iLCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIGlkcG9ydGVuOnNjb3Blcy53cml0ZSBpZHBvcnRlbjpzY29wZXMucmVhZCB0b2tlbmluZm8gaWRwb3J0ZW46YXV0aG9yaXphdGlvbnMucmV2b2tlIiwiaXNzIjoib2lkY190ZXN0X2FwaS1wb3N0bWFuIiwiZXhwIjoxNTY4MTk2NjE2LCJpYXQiOjE1NjgxOTY0OTYsImp0aSI6ImU1ZTU4ZDIzLWJjMjYtNDU0Mi1iMDkyLTgzNmE4OGMzYzg2NiJ9.bQpiG8MGSafrmpLAu948MQnW2EtZCunc4PMtYGeuW3FGxQtZVvRtN5_OWgRQWIubCOH4rzQARtEz52uuO4vo1kbMtUSr6H5ZHUGq1OPYW_9evj98uFeUbWlB-Xt4CS7bG0LhuFjlF7guG23jLG4yvhxwZW_PCR8ettbhbzAm-GqFExfXvXk6M2hJUzKWGt0VPAGvS3wf1gOlc9-D8lV0yk2abJGHDEofYdsltlguNX5he6xA5QQyF-Qy8kEgJnLHQl6tsnq-EOMgT3FVKJ0rg_kwpnnz_Q61h_Hn7SZBmD_CSuSEyDwm20yMIzyb1uca9SRkfk8vXchdL83V2gCwhA",
              "type": "text"
            }
          ]
        },
        "url": "{{oidc_provider}}/token"
      },
      "response": []
    }
  ]
}